parameters:
  # artifacts files or directory
  # props:
  # - path
  # - condition
  - name: artifacts
    type: object
    default: {}
  # the path to store the 7z file
  # the file is overwritten for each artifact
  - name: uploadPath
    type: string
    default: $(Build.ArtifactStagingDirectory)/artifact_zip_upload.7z

steps:
  - ${{ each artifact in parameters.artifacts }}:
    - task: ArchiveFiles@2
      inputs:
        rootFolderOrFile: ${{artifact.path}}
        archiveType: 7z
        sevenZipCompression: ultra
        archiveFile: ${{parameters.uploadPath}}
        replaceExistingArchive: true
      displayName: Compress ${{artifact.path}}
      ${{ if artifact.condition }}:
        condition: ${{artifact.condition}}

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: ${{parameters.uploadPath}}
        ArtifactName: ${{artifact.path}}
      displayName: Upload ${{artifact.path}}
      ${{ if artifact.condition }}:
        condition: ${{artifact.condition}}
